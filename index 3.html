
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>KTP Creator Hub – Bewertung</title>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
      import { getFirestore, collection, addDoc, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";

      const firebaseConfig = {
        apiKey: "AIzaSyDk2xg99xrf8Lokjn2iX2A6cX2TsU3PYOA",
        authDomain: "kiniko-2768a.firebaseapp.com",
        projectId: "kiniko-2768a",
        storageBucket: "kiniko-2768a.firebasestorage.app",
        messagingSenderId: "815872158013",
        appId: "1:815872158013:web:f645bde632f5d235c17d54",
        measurementId: "G-MRSCFYCWWK"
      };

      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);

      async function submitReview() {
        const stars = document.getElementById("stars").value;
        const comment = document.getElementById("comment").value;

        if (!stars || !comment) {
          alert("Bitte Bewertung und Kommentar ausfüllen.");
          return;
        }

        await addDoc(collection(db, "reviews"), {
          stars: Number(stars),
          comment,
          created: serverTimestamp()
        });

        alert("Bewertung gespeichert!");
        loadReviews();
        document.getElementById("review-form").reset();
      }

      async function loadReviews() {
        const snap = await getDocs(collection(db, "reviews"));
        const out = document.getElementById("reviews");
        out.innerHTML = "";
        let sum = 0;
        let count = 0;

        snap.forEach(doc => {
          const data = doc.data();
          sum += data.stars;
          count++;
          out.innerHTML += `<p><strong>${data.stars} Sterne</strong> – ${data.comment}</p>`;
        });

        if (count > 0) {
          const avg = (sum / count).toFixed(1);
          document.getElementById("avg").innerText = "Durchschnitt: " + avg + " Sterne";
        }
      }

      window.submitReview = submitReview;
      window.onload = loadReviews;
    </script>
  </head>
  <body>
    <h1>Buch bewerten</h1>
    <div id="avg">Durchschnitt: </div>
    <form id="review-form">
      <label>Sterne (1–5):</label><br />
      <input type="number" id="stars" min="1" max="5"><br />
      <label>Kommentar:</label><br />
      <textarea id="comment"></textarea><br />
      <button type="button" onclick="submitReview()">Bewerten</button>
    </form>

    <h2>Alle Bewertungen</h2>
    <div id="reviews"></div>
  </body>
</html>
    